name: Deploy para VM Local

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted  # Roda na prÃ³pria VM!

    steps:
      - name: Checkout do cÃ³digo
        uses: actions/checkout@v3

      - name: Atualizar site
        run: |
          if [ ! -d "/var/www/html/atividade-fernando/.git" ]; then
            echo "ğŸ” RepositÃ³rio ainda nÃ£o existe, clonando..."
            sudo rm -rf /var/www/html/atividade-fernando
            sudo git clone https://github.com/GustavoPelissari/atividade-fernando.git /var/www/html/atividade-fernando
          else
            echo "ğŸ“¦ Atualizando cÃ³digo existente..."
            cd /var/www/html/atividade-fernando
            sudo git pull origin main
          fi

          sudo systemctl restart nginx
          echo "âœ… Deploy realizado com sucesso em $(date)"
